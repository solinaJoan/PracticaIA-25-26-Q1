\section{Funció heurística}
\label{sec:heuristic}

\vspace{0.5cm}

\subsection{Objectiu de la funció heurística}

En el context del nostre problema de gestió de peticions amb limitacions de recursos, l'objectiu principal de la heurística és ajudar-nos a decidir quines peticions atendre i en quin ordre, de manera que s’aconsegueixi un equilibri entre diversos factors. Concretament, la funció heurística ha de perseguir tres objectius principals:

\begin{enumerate}
\item \textbf{Maximitzar el benefici:} Prioritzar les peticions que generin més guany net, és a dir, aquelles que aporten un major benefici econòmic un cop considerats els costos associats.
\item \textbf{Minimitzar els costos:} Reduir la distància total recorreguda pels camions, ja que cada quilòmetre recorregut representa un cost directe.
\item \textbf{Prioritzar l'urgència:} Donar preferència a les peticions que porten més dies esperant, ja que la seva demora pot afectar negativament el benefici total o la satisfacció del servei.
\end{enumerate}

En resum, la funció heurística ha de ser capaç de mesurar de manera equilibrada el compromís entre obtenir ingressos, controlar costos i respectar la urgència de les peticions.

\vspace{0.5cm}

\subsection{Factors que intervenen}

Per poder construir una heurística eficaç, cal tenir en compte diversos factors que influeixen directament en el benefici net de qualsevol solució:

\vspace{0.5cm}

\subsubsection{Benefici de les peticions servides}

Cada petició té associat un benefici que depèn dels dies que porta pendent. Si una petició s’atén immediatament, el benefici és màxim, i si es demora, aquest benefici disminueix segons una funció decreixent:

\begin{equation}
B_{\text{petició}}(d) = 
\begin{cases}
1000 \times 1.02 & \text{si } d = 0 \\
1000 \times \left(1 - \frac{2^d}{100}\right) & \text{si } d > 0
\end{cases}
\label{eq:benefici-peticio}
\end{equation}

Així, el benefici total d’una solució és simplement la suma dels beneficis de totes les peticions servides:

\begin{equation}
B_{\text{servides}} = \sum_{p \in P_{\text{servides}}} B_{\text{petició}}(d_p)
\end{equation}

\vspace{0.5cm}

\subsubsection{Penalització de les peticions no servides}

Quan una petició no s’atén en un dia determinat, això suposa una pèrdua potencial, ja que el benefici que s’hauria obtingut disminueix l’endemà. La penalització per no servir una petició es calcula com la diferència entre el benefici si s’atén avui i el benefici si s’atén l’endemà:

\begin{equation}
P_{\text{no servides}} = \sum_{p \in P_{\text{no servides}}} \left(B_{\text{petició}}(d_p) - B_{\text{petició}}(d_p + 1)\right)
\end{equation}

Aquesta penalització permet a la heurística tenir en compte el cost d’oportunitat de deixar peticions pendents.

\vspace{0.5cm}

\subsubsection{Cost dels quilòmetres}

El cost derivat del recorregut dels camions és un factor directe que cal minimitzar. Cada quilòmetre té un cost fix de 2 unitats, i per tant el cost total és la suma del cost de tots els quilòmetres recorreguts pels camions:

\begin{equation}
C_{\text{km}} = 2 \times \sum_{c=1}^{n} \text{km}_c
\end{equation}

\vspace{0.5cm}

\subsection{Funcions heurístiques proposades}

A partir d’aquests factors, s’han considerat diverses heurístiques, amb diferents graus de complexitat i precisió:

\vspace{0.5cm}

\subsubsection{Heurística H1: Només benefici}

La primera proposta és una heurística senzilla que només té en compte el benefici net (beneficis menys costos):

\begin{equation}
h_1(\text{estat}) = -(B_{\text{servides}} - C_{\text{km}})
\end{equation}

El signe negatiu es fa servir per convertir un problema de maximització en un de minimització, compatible amb els requisits d’algoritmes de cerca com els de la biblioteca AIMA. Aquesta heurística és molt fàcil de calcular i reflecteix directament l’objectiu principal, però té la limitació que no penalitza explícitament les peticions que es deixen sense servir, cosa que podria fer que s’ignorin peticions amb molts dies d’espera si el seu cost és elevat.

\vspace{0.5cm}

\subsubsection{Heurística H2: Benefici amb penalització}

Una evolució de l’anterior consisteix a afegir la penalització per peticions no servides:

\begin{equation}
h_2(\text{estat}) = -(B_{\text{servides}} - P_{\text{no servides}} - C_{\text{km}})
\end{equation}

Aquesta variant incentiva explícitament a servir totes les peticions rendibles, ja que la penalització dóna un cost addicional a deixar-les pendents. Així, H2 és més completa que H1 i evita situacions en què es deixin peticions importants sense atendre, tot i que pot conduir a servir peticions amb rendibilitat baixa i té un càlcul lleugerament més complex.

\vspace{0.5cm}

\subsection{Heurística escollida}

Després d’analitzar els pros i contres, s’ha escollit H2 per als experiments principals:

\begin{equation}
h(\text{estat}) = -(B_{\text{servides}} - \cdot P_{\text{no servides}} - C_{\text{km}})
\end{equation}

Aquesta decisió es basa en el fet que H2 equilibra els tres objectius i és més completa que H1. No hem considerat afegir ponderacions, ja que tots els operadors tenen la mateixa unitat (€) i l'enunciat no especificava si era més important maximitzar ingressos o minimitzar pèrdues o costos. Sense ponderacions, els tres objectius tenen el mateix pes a l'hora de buscar una solució.
