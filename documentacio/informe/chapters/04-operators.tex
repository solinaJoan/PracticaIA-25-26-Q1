\sections{Operadors}
\label{sec:operadors}

\subsection{Descripció dels Operadors}

Els operadors són les accions que ens permeten moure'ns per l'espai de solucions. Cada operador agafa un estat i genera un nou estat modificant lleugerament l'assignació de peticions. La clau és dissenyar operadors que permetin arribar a qualsevol solució però que tinguin un factor de ramificació raonable. N'hem considerat 5:

\subsubsection{Operador: Afegir Petició}

Aquest operador afegeix una petició no assignada a un viatge existent que encara no ha arribat a la seva capacitat màxima. Per poder aplicar-lo, cal que existeixi almenys una petició no assignada i almenys un viatge que no estigui ple. A més, el viatge destí ha de complir totes les restriccions després d'afegir la petició, és a dir, no pot superar la capacitat del camió, la distància total del viatge ha de romandre dins dels límits permesos, i no es pot excedir el nombre màxim de gasolineres per viatge.

L'efecte principal és que la petició passa de la llista de no assignades a formar part del viatge seleccionat, i es recalculen automàticament tots els paràmetres del viatge com la distància i la càrrega. La implementació recorre tots els camions i tots els seus viatges, provant d'afegir cada petició no assignada a cada viatge que tingui espai disponible.

\subsubsection{Operador: Treure Petició}

Aquest operador fa exactament l'operació inversa a l'anterior: elimina una petició d'un viatge existent i la torna a la llista de peticions no assignades. L'única condició necessària és que existeixi almenys un viatge amb peticions assignades. No hi ha cap restricció adicional, ja que treure una petició sempre allibera espai i redueix la càrrega del viatge.

Quan s'elimina una petició, aquesta es retorna a la llista de no assignades i es recalculen els paràmetres del viatge origen. Si després de treure la petició el viatge queda completament buit, aquest s'elimina automàticament. L'operador recorre tots els viatges de tots els camions i genera un successor per cada petició que pot ser eliminada. 

\subsubsection{Operador: Moure Petició}

Aquest operador transfereix una petició d'un viatge origen a un viatge destí diferent, que pot pertànyer al mateix camió o a un altre. Per aplicar-lo, el viatge origen ha de tenir almenys una petició assignada, el viatge destí no pot estar ple, i obviament origen i destí no poden ser el mateix viatge. A més, tant el viatge origen com el destí han de complir totes les restriccions després del moviment.

Els efectes són una combinació dels dos operadors anteriors: la petició s'elimina del viatge origen i s'afegeix al viatge destí. Si el viatge origen queda buit després del moviment, s'elimina automàticament. L'operador considera totes les possibles combinacions de viatges origen i destí entre tots els camions, i per a cada combinació vàlida prova de moure cada petició disponible.

\subsubsection{Operador: Intercanviar Peticions}

Aquest operador intercanvia dues peticions entre dos viatges diferents, que poden pertànyer al mateix camió o a camions diferents. Cal que existeixin almenys dos viatges amb peticions assignades, que els dos viatges no siguin el mateix, i que ambdós compleixin les restriccions després de l'intercanvi.

L'efecte és un simple intercanvi: cada petició passa a ocupar la posició de l'altra en el seu respectiu viatge. L'operador considera totes les parelles possibles de viatges i, per a cada parella, prova d'intercanviar cada parell de peticions possible. Només genera successors quan l'intercanvi manté les restriccions en ambdós viatges.

\subsubsection{Operador: Crear Viatge}

Aquest operador crea un nou viatge per a un camió i li assigna una petició no assignada. Les condicions són que existeixi almenys una petició no assignada, que el camió seleccionat no hagi arribat al nombre màxim de viatges permesos per dia, i que el nou viatge compleixi les restriccions.

L'efecte és la creació d'un nou viatge amb una sola petició, que s'afegeix a la llista de viatges del camió. La petició passa de no assignada a assignada, i s'incrementa el comptador de viatges del camió. L'operador recorre tots els camions que encara poden acceptar més viatges i, per a cada petició no assignada, intenta crear un nou viatge si es compleixen les restriccions.

\subsection{Anàlisi del Factor de Ramificació}

El factor de ramificació determina quants successors es poden generar des d'un estat donat. Per analitzar-lo, utilitzarem la notació següent: $C$ per al nombre de camions, $V$ per al nombre total de viatges en l'estat actual, $P$ per al nombre total de peticions assignades, $P_{max}$ per al nombre màxim de peticions per viatge, i $N$ per al nombre de peticions no assignades.

\subsubsection{Anàlisi per Operador}

L'\textbf{operador afegir} itera sobre tots els viatges no plens i prova d'afegir-hi cada petició no assignada. En el pitjor cas, si tots els viatges tenen espai, genera aproximadament $V \times N$ successors. Aquesta xifra es redueix considerablement quan els viatges s'omplen, arribant a zero quan tots els viatges estan plens o no queden peticions per assignar.

\vspace{0.5em}  
L'\textbf{operador treure} genera un successor per cada petició assignada en qualsevol viatge. Això dóna un factor de ramificació de $P$ successors, que és relativament estable durant l'execució, tot i que disminueix lleugerament a mesura que s'assignen més peticions.\\[0.5em] 

L'\textbf{operador moure} és més costós. Ha de considerar cada parella possible de viatges (origen i destí) i, per a cada una, provar de moure cada petició del viatge origen al destí. Això resulta en aproximadament $V^2 \times \frac{P}{V}$ successors en el cas mitjà, que es pot simplificar a $V \times P$. En el pitjor cas, quan hi ha molts viatges amb poques peticions cadascun, aquest nombre pot créixer fins a $V^2 \times P_{max}$.

\vspace{0.5em}
L'\textbf{operador intercanviar} té el factor de ramificació més elevat. Per a cada parella de viatges diferents, prova d'intercanviar cada parell de peticions entre ells. Això genera $\binom{V}{2} \times \frac{P}{V} \times \frac{P}{V}$ successors, que en el cas general és de l'ordre de $V^2 \times P^2 / V^2 = P^2$. Quan hi ha molts viatges amb poques peticions, aquest valor pot arribar a ser molt elevat.

\vspace{0.5em}
L'\textbf{operador crear} genera $C \times N$ successors en el pitjor cas, quan tots els camions poden acceptar més viatges. Aquest nombre es redueix linealment amb el nombre de peticions no assignades i amb el nombre de camions que ja han arribat al màxim de viatges permesos.
\subsection{Elecció dels Operadors}

Els cinc operadors han estat seleccionats per proporcionar una cobertura completa de l'espai de solucions i permetre tant la construcció incremental com l'optimització de solucions existents.

\subsubsection{Construcció de Solucions}
\begin{itemize}
    \item \textbf{Afegir Petició:} Operador fonamental per construir solucions des d'un estat inicial buit o parcial. Permet la construcció incremental de viatges.
    \item \textbf{Crear Viatge:} Complementa l'operador anterior permetent iniciar nous viatges quan els existents no són adequats.
\end{itemize}

\subsubsection{Millora de Solucions}
\begin{itemize}
    \item \textbf{Moure Petició:} Permet reequilibrar la càrrega entre viatges i camions, essencial per optimitzar distàncies i utilitzar millor la capacitat.
    \item \textbf{Intercanviar Peticions:} Facilita l'optimització local sense canviar el nombre de peticions assignades, útil per millorar rutes sense desestabilitzar la solució.
\end{itemize}

\subsubsection{Exploració i Backtracking}
\begin{itemize}
    \item \textbf{Treure Petició:} Essencial per a algoritmes de cerca local (Hill Climbing, Simulated Annealing) que necessiten poder desfer assignacions per explorar alternatives.
\end{itemize}
